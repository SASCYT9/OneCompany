# OneCompany Docker Deployment

## üê≥ –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

### 1. –ë—ñ–ª–¥ —Ç–∞ –∑–∞–ø—É—Å–∫ –∑ Docker Compose:
```bash
docker-compose up -d --build
```

### 2. –ê–±–æ –±—ñ–ª–¥ –æ–∫—Ä–µ–º–æ:
```bash
# –ë—ñ–ª–¥ –æ–±—Ä–∞–∑—É
docker build -t onecompany-3d .

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker run -p 3000:3000 onecompany-3d
```

## üìã –î–æ—Å—Ç—É–ø–Ω—ñ –∫–æ–º–∞–Ω–¥–∏

### –ó—É–ø–∏–Ω–∏—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:
```bash
docker-compose down
```

### –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ª–æ–≥–∏:
```bash
docker-compose logs -f onecompany-web
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏:
```bash
docker-compose restart
```

### –í–∏–¥–∞–ª–∏—Ç–∏ –≤—Å–µ (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏, –æ–±—Ä–∞–∑–∏, volumes):
```bash
docker-compose down -v --rmi all
```

## üåê –î–æ—Å—Ç—É–ø –¥–æ —Å–∞–π—Ç—É

–ü—ñ—Å–ª—è –∑–∞–ø—É—Å–∫—É —Å–∞–π—Ç –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π –Ω–∞:
- **http://localhost:3000**

### –ü—É–±–ª—ñ—á–Ω–∏–π —Ç–∏–º—á–∞—Å–æ–≤–∏–π –ª—ñ–Ω–∫ (Docker Cloudflare Tunnel)

–ú–∏ –¥–æ–¥–∞–ª–∏ —Å–µ—Ä–≤—ñ—Å `tunnel` —É `docker-compose.yml`, —è–∫–∏–π —Å—Ç–≤–æ—Ä—é—î –ø—É–±–ª—ñ—á–Ω–∏–π HTTPS‚ÄëURL —á–µ—Ä–µ–∑ Cloudflare Tunnel —ñ –ø—Ä–æ–∫–∏–¥—É—î –π–æ–≥–æ –Ω–∞ `onecompany-web:3000`.

–ó–∞–ø—É—Å–∫ (—Ä–∞–∑–æ–º —ñ–∑ –≤–µ–±–æ–º):

```bash
docker-compose up -d --build
```

–û—Ç—Ä–∏–º–∞—Ç–∏ –ø—É–±–ª—ñ—á–Ω–∏–π –ª—ñ–Ω–∫:

```bash
docker-compose logs -f tunnel
```

–£ –ª–æ–≥–∞—Ö –∑'—è–≤–∏—Ç—å—Å—è –∞–¥—Ä–µ—Å–∞ —Ç–∏–ø—É: `https://<random>.trycloudflare.com` ‚Äî –ø–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Ü–∏–º –ª—ñ–Ω–∫–æ–º.

–ü—Ä–∏–º—ñ—Ç–∫–∞: —É –¥–µ—è–∫–∏—Ö –º–µ—Ä–µ–∂–∞—Ö (–∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ñ –ø—Ä–æ–∫—Å—ñ/–∞–Ω—Ç–∏–≤—ñ—Ä—É—Å–∏) quick tunnel –º–æ–∂–µ –Ω–µ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏—Å—è —á–µ—Ä–µ–∑ TLS‚Äë–ø–µ—Ä–µ–≤—ñ—Ä–∫—É. –£ —Ç–∞–∫–æ–º—É —Ä–∞–∑—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ –≤–∞—Ä—ñ–∞–Ω—Ç –Ω–∏–∂—á–µ (ngrok).

–ó—É–ø–∏–Ω–∫–∞:

```bash
docker-compose down
```

## üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Docker

- **Stage 1 (deps)**: –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
- **Stage 2 (builder)**: –ë—ñ–ª–¥ Next.js –ø—Ä–æ–µ–∫—Ç—É
- **Stage 3 (runner)**: –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π production –æ–±—Ä–∞–∑

## ‚ö° –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó

- Multi-stage build –¥–ª—è –º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É –æ–±—Ä–∞–∑—É
- Alpine Linux (–º—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ –±–∞–∑–∞)
- Standalone output Next.js
- Node.js 20 LTS
- Non-root user –¥–ª—è –±–µ–∑–ø–µ–∫–∏

## üìä –†–æ–∑–º—ñ—Ä –æ–±—Ä–∞–∑—É

–§—ñ–Ω–∞–ª—å–Ω–∏–π –æ–±—Ä–∞–∑: ~150-200 MB (–∑–∞–≤–¥—è–∫–∏ multi-stage build)

## üîß –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

–í—Å—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤ `next.config.ts`:
- `output: 'standalone'` - –¥–ª—è Docker
- `compress: true` - gzip –∫–æ–º–ø—Ä–µ—Å—ñ—è
- `optimizeCss: true` - –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è CSS

## üöÄ Production Deployment

–î–ª—è deployment –Ω–∞ —Å–µ—Ä–≤–µ—Ä:
```bash
# 1. –ö–ª–æ–Ω—É–≤–∞—Ç–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π
git clone <repo-url>
cd onecompany-3d

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç–∏ Docker Compose
docker-compose up -d --build

# 3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å
docker-compose ps

# (–û–ø—Ü—ñ–π–Ω–æ) –û—Ç—Ä–∏–º–∞—Ç–∏ –ø—É–±–ª—ñ—á–Ω–∏–π –ª—ñ–Ω–∫
docker-compose logs -f tunnel

## üîÅ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ —Ç—É–Ω–µ–ª—é: ngrok (—á–µ—Ä–µ–∑ Docker)

1) –ó–∞—Ä–µ—î—Å—Ç—Ä—É–π—Ç–µ—Å—å —Ç–∞ –≤—ñ–∑—å–º—ñ—Ç—å —Ç–æ–∫–µ–Ω: https://ngrok.com/

2) –°—Ç–≤–æ—Ä—ñ—Ç—å `.env` —ñ–∑ —Ç–æ–∫–µ–Ω–æ–º (–Ω–∞ –æ—Å–Ω–æ–≤—ñ `.env.example`):

```bash
cp .env.example .env
# –≤—ñ–¥—Ä–µ–¥–∞–≥—É–π—Ç–µ .env —ñ –≤—Å—Ç–∞–≤—Ç–µ NGROK_AUTHTOKEN
```

3) –ó–∞–ø—É—Å—Ç—ñ—Ç—å –∑ –¥–æ–¥–∞—Ç–∫–æ–≤–∏–º compose‚Äë—Ñ–∞–π–ª–æ–º:

```bash
docker compose -f docker-compose.yml -f docker-compose.ngrok.yml up -d
```

4) –ü–æ–¥–∏–≤—ñ—Ç—å—Å—è URL —É –ª–æ–≥–∞—Ö:

```bash
docker compose -f docker-compose.yml -f docker-compose.ngrok.yml logs -f ngrok
```

–ë—É–¥–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –≤–∏–¥—É `https://<random>.ngrok.app`.
```

## üîí –ë–µ–∑–ø–µ–∫–∞

- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∞—Ü—é—î –≤—ñ–¥ —ñ–º–µ–Ω—ñ –Ω–µ–ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (nextjs)
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π Node.js Alpine –æ–±—Ä–∞–∑
- .dockerignore –≤–∏–∫–ª—é—á–∞—î –Ω–µ–ø–æ—Ç—Ä—ñ–±–Ω—ñ —Ñ–∞–π–ª–∏
